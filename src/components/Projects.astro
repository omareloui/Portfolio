---
import PreviewProject from "@components/PreviewProject.astro";
import SectionWrapper from "@components/SectionWrapper.astro";

import { createClient, Asset } from "contentful";

const client = createClient({
  space: import.meta.env.CONTENTFUL_SPACE_ID!,
  accessToken: import.meta.env.CONTENTFUL_ACCESS_TOKEN!,
});

type Project = {
  index: number;
  title: string;
  subtitle: string;
  description: string;
  link: string;
  github: string;
  design: string;
  image: Asset;
  technologies: string[];
  images: Asset[] | string[];
};

const { items } = await client.getEntries<Project>();
const projects = items
  .map(x => {
    const { fields } = x;
    fields.images = fields.images.map(x => (x as Asset).fields.file.url);
    return fields;
  })
  .sort((a, b) => a.index - b.index);
---

<SectionWrapper
  id="projects"
  title="Projects"
  shadowTitle="Showcase"
  isOdd={true}
  class="projects"
>
  <!-- @ts-ignore -->
  {projects.map(project => <PreviewProject project={project} />)}
</SectionWrapper>

<style lang="scss">
  @use "../assets/styles/mixins.scss" as *;

  .projects {
    display: grid;
    gap: 50px;
  }
</style>
